
# Notification Microservice  

This module is a simple **Email sender mechanism**. Its purpose is to send notification emails of some of the **events** generated by the other microservices and it self that are part of the **Olympus** project.  

Basically, this application exposes 2 single endpoints (as a RESTFul service) that accepts an Message (json) object, which is sent via email.  


## How it works

1. The project includes a properties file  (**application.properties**), with the entries:  
   `mail.host: To indicate the host to use to send emails notifications`
   `mail.username, mail.password: To indicate user credentials for email account`
   `mail.mailTo: To indicate the destination email address`

2. On a daily basis, the module sends email usign basic standar email structure and recipients:  
   `from:{properties.from}, to:{properties.to}, subject:{properties.subject}, body:{body}`
   
3. An HTTP client can email a message, by hitting the endpoint  
   `http://{server-domain|ip}/olympus/notification/v1/event`  
   sending a POST request in JSON format, with the body containing the event data:  
   `{`  
   `   "source": "ms.processFile",`  
   `   "status": status-code,`  
   `   "msg": "message-description",`  
   `    "file": "file-name" `  
   `}`  
   
5. For each mesagge received, if validation is correct the module generates an email notification with the next information:  
   `{messagge.source},{messagge.status},{messagge.msg},{messagge.file}`  
   
6. If an email notification can not be sent (due to a data validation rule or communication  issue) the corresponding  
   lofEvent  event is created and setn to the Olympus.ms.logEvent microservice (https://github.com/tonysofthonda/olympus_ms_logevent).  

7. The health-check endpoint can be used to verify if the application is up and running.  
   `http://{server-domain|ip}:8083/olympus/notification/v1/health`  


## Tools  

+ Java v1.8.0_202
+ Maven v3.8.6
+ Spring Boot v2.6.14
+ JUnit v5.8.2 with AssertJ v3.21.0
+ Lombok v1.18.24
+ Logback v1.2.11


## Run the app

Obtaining the application's Jar file  
`$ mvn clean install`  
  
Running the project as an executable JAR  
`$ mvn spring-boot:run`  

Running the tests  
`$ mvn test`  


## Usage

### 1. Send eamil notification (sending valid data)

#### Request
`POST /olympus/notification/v1/event`

    curl -X POST -H 'Content-Type: application/json' -d '{"source": "ms.notification", "status": 1, "msg": "Succes process", "file": "fexampleFile.txt"}' http://{server-domain|ip}/olympus/logevent/v1/event

#### Response
    HTTP/1.1 200
    Content-Type: text/plain;charset=UTF-8
    Content-Length: 2
    Date: Mon, 15 May 2023 05:00:55 GMT

    {
    "message": "Notification successfully sent",
    "details": 
}

### 2. Send eamil notification (sending invalid data)

#### Request
`POST /olympus/logevent/v1/event`

    curl -i -X POST -H 'Content-Type: application/json' -d '{"source": , "status": "X", "msg": "Succes process", "file": "fexampleFile.txt"}' http://{server-domain|ip}/olympus/logevent/v1/event

#### Response
    HTTP/1.1 400
    Content-Type: application/json
    Transfer-Encoding: chunked
    Date: Mon, 15 May 2023 05:00:55 GMT
    
    {
        "timestamp": "2023-05-17T12:25:28.062-05:00",
        "status": 400,
        "errors": [
            "source is mandatory"
        ]
    }

